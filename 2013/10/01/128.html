<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>emlog的一键备份 - 纯真年代</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="emlog的一键备份" />
<meta property="og:description" content="不知道大家平时备份是不是和我一样这么操作的：


登陆到后台，备份sql（当然，或者是用插件定期备份发送到邮箱）
用ftp备份content目录



如果你想简化操作，并且和我一样苦逼的用着虚拟主机，下面的脚本也许可以帮到你。脚本很丑陋，能完成功能即可。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pureage.info/2013/10/01/128.html" />
<meta property="article:published_time" content="2013-10-01T03:31:00&#43;00:00"/>
<meta property="article:modified_time" content="2013-10-01T03:31:00&#43;00:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="emlog的一键备份"/>
<meta name="twitter:description" content="不知道大家平时备份是不是和我一样这么操作的：


登陆到后台，备份sql（当然，或者是用插件定期备份发送到邮箱）
用ftp备份content目录



如果你想简化操作，并且和我一样苦逼的用着虚拟主机，下面的脚本也许可以帮到你。脚本很丑陋，能完成功能即可。"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" /><script src="/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title">纯真年代</h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">首页</a>
			</li>
			
			<li>
				<a href="/posts">归档</a>
			</li>
			
			<li>
				<a href="/about">关于</a>
			</li>
			
			<li>
				<a href="/tags">标签</a>
			</li>
			
			<li>
				<a href="/tags">工具</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">emlog的一键备份</h1>
			<div class="meta">Posted at &mdash; Oct 1, 2013</div>
		</div>

		<div class="markdown">
			<p>不知道大家平时备份是不是和我一样这么操作的：</p>

<ol>
<li>登陆到后台，备份sql（当然，或者是用插件定期备份发送到邮箱）<br /></li>
<li>用ftp备份content目录
<br /></li>
</ol>

<p>如果你想简化操作，并且和我一样苦逼的用着虚拟主机，下面的脚本也许可以帮到你。脚本很丑陋，能完成功能即可。</p>

<p><strong>1.linux</strong></p>

<p>（1） 将下面脚本中config标记部分需要自己配置，意义如下：</p>

<ul>
<li>backup_path：content目录和sql文件要存放的目录<br /></li>
<li>emlog_domain:你的博客域名，例如：<a href="http://www.pureage.info">http://www.pureage.info</a><br /></li>
<li>emlog_user:你博客的登录名<br /></li>
<li>emlog_password：你博客的登陆密码<br /></li>
<li>remotecontent：你ftp上content目录的完整url，带上你的ftp账号和密码信息，例如：     <a href="ftp://admin:password@127.0.0.1/domains/xxxx.com/public_html/content">ftp://admin:password@127.0.0.1/domains/xxxx.com/public_html/content</a> 将admin,password改成你自己的ftp账号、密码，把127.0.0.1改成你ftp的IP（通常就是主机IP）,domains/xxxx.com/public_html/contentg改成你自己的content在ftp上的目录即可。<br />
<br /></li>
</ul>

<p>（2）假设将该脚本命名为emlog_backup.sh，执行chmod +x emlog_backup.sh，赋予可执行属性。</p>

<p>（3）执行./emlog_backup.sh:</p>

<ul>
<li>如果不带参数，或执行./emlog_backup.sh all 则先备份数据库，再备份content目录<br /></li>
<li>如果是执行./emlog_backup.sh sql，则只备份数据库<br /></li>
<li>如果是执行./emlog_backup.sh content，则只备份content目录<br />
<br /></li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="color:#00f">#!/bin/bash  
</span><span style="color:#00f"></span>  
<span style="color:#008000">#-----config------------</span>  
backup_path=<span style="color:#a31515">&#34;/home/strider/blog/backup&#34;</span>  
emlog_domain=<span style="color:#a31515">&#34;http://www.pureage.info&#34;</span>  
emlog_user=<span style="color:#a31515">&#34;aaaaa&#34;</span>  
emlog_password=123456  
remote_content=<span style="color:#a31515">&#34;ftp://admin:123456@127.0.0.1/domains/pureage.info/public_html/content&#34;</span>  
<span style="color:#008000">#----------------------</span>  
  
  
<span style="color:#008000">#-----</span>  
mkdir -p <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">&#34;</span>  
  
<span style="color:#00f">if</span> [ -d <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">/content&#34;</span> ];<span style="color:#00f">then</span>  
mv <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">/content&#34;</span> <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">/content_old&#34;</span>  
<span style="color:#00f">fi</span>  
  
  
  
backup_database()  
{  
        <span style="color:#008000">#----get the cookie----</span>  
        curl -d <span style="color:#a31515">&#34;user=</span>$emlog_user<span style="color:#a31515">&amp;pw=</span>$emlog_password<span style="color:#a31515">&#34;</span>  <span style="color:#a31515">&#34;</span>$emlog_domain<span style="color:#a31515">&#34;</span>/admin/index.php?action=login -c <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">/cookie&#34;</span>  
  
  
        <span style="color:#008000">#----back up database----</span>  
        table_backup=(  
        <span style="color:#a31515">&#34;emlog_attachment&#34;</span>  
        <span style="color:#a31515">&#34;emlog_blog&#34;</span>  
        <span style="color:#a31515">&#34;emlog_comment&#34;</span>  
        <span style="color:#a31515">&#34;emlog_options&#34;</span>  
        <span style="color:#a31515">&#34;emlog_navi&#34;</span>  
        <span style="color:#a31515">&#34;emlog_reply&#34;</span>  
        <span style="color:#a31515">&#34;emlog_sort&#34;</span>  
        <span style="color:#a31515">&#34;emlog_link&#34;</span>  
        <span style="color:#a31515">&#34;emlog_tag&#34;</span>  
        <span style="color:#a31515">&#34;emlog_trackback&#34;</span>  
        <span style="color:#a31515">&#34;emlog_twitter&#34;</span>  
        <span style="color:#a31515">&#34;emlog_user&#34;</span>  
        )  
        table_box=<span style="color:#00f">$(</span>  
        let i=0;  
        <span style="color:#00f">for</span>((i=0;i&lt;<span style="color:#a31515">${#</span>table_backup[@]<span style="color:#a31515">}</span>-1;i=i+1<span style="color:#00f">)</span>)  
        <span style="color:#00f">do</span>  
        echo -n <span style="color:#a31515">&#34;table_box[</span>$i<span style="color:#a31515">]=</span><span style="color:#a31515">${</span>table_backup[$i]<span style="color:#a31515">}</span><span style="color:#a31515">&amp;&#34;</span>  
        <span style="color:#00f">done</span>  
        echo -n <span style="color:#a31515">&#34;table_box[</span>$i<span style="color:#a31515">]=</span><span style="color:#a31515">${</span>table_backup[$i]<span style="color:#a31515">}</span><span style="color:#a31515">&#34;</span>  
        )  
        echo $table_box  
  
        sql_file=<span style="color:#a31515">&#34;</span><span style="color:#00f">$(</span>date <span style="color:#a31515">&#34;+%Y_%m_%d_%H_%M_%S&#34;</span><span style="color:#00f">)</span><span style="color:#a31515">.sql&#34;</span>  
  
        curl  -b <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">/cookie&#34;</span> -L    -d <span style="color:#a31515">&#34;</span>$table_box<span style="color:#a31515">&#34;</span>  <span style="color:#a31515">&#34;</span>$emlog_domain<span style="color:#a31515">&#34;</span>/admin/data.php?action=bakstart&gt;<span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">/</span>$sql_file<span style="color:#a31515">&#34;</span>  
  
        <span style="color:#008000">#----delete the cookie----</span>  
        rm -rf <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">/cookie&#34;</span>  
}  
  
backup_content()  
{  
        wget  -r  -nH --cut-dirs=3  -nv <span style="color:#a31515">&#34;</span>$remote_content<span style="color:#a31515">&#34;</span> -P <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">&#34;</span>  
  
        <span style="color:#008000">#----delete old content</span>  
        <span style="color:#00f">if</span>  [ -d <span style="color:#a31515">&#34;</span>$backup__path<span style="color:#a31515">/content&#34;</span> ];<span style="color:#00f">then</span>  
                rm -rf <span style="color:#a31515">&#34;</span>$backup_path<span style="color:#a31515">/content&#34;</span>  
        <span style="color:#00f">fi</span>  
}  
  
  
<span style="color:#00f">if</span> [ $# -eq 0 ];<span style="color:#00f">then</span>  
        backup_database  
        backup_content  
        exit 0  
  
<span style="color:#00f">elif</span> [ $# -eq 1 ];<span style="color:#00f">then</span>  
        <span style="color:#00f">if</span> [ <span style="color:#a31515">&#34;</span>$1<span style="color:#a31515">&#34;</span> == <span style="color:#a31515">&#34;all&#34;</span> ];<span style="color:#00f">then</span>  
                backup_database  
                backup_content  
                exit 0  
  
        <span style="color:#00f">elif</span> [ <span style="color:#a31515">&#34;</span>$1<span style="color:#a31515">&#34;</span> == <span style="color:#a31515">&#34;sql&#34;</span> ];<span style="color:#00f">then</span>  
                backup_database  
                exit 0  
  
        <span style="color:#00f">elif</span> [ <span style="color:#a31515">&#34;</span>$1<span style="color:#a31515">&#34;</span> == <span style="color:#a31515">&#34;content&#34;</span> ];<span style="color:#00f">then</span>  
                backup_content  
                exit 0  
        <span style="color:#00f">else</span>  
                echo <span style="color:#a31515">&#34;operation not supported!&#34;</span>  
                exit 1  
        <span style="color:#00f">fi</span>  
  
<span style="color:#00f">else</span>  
        echo <span style="color:#a31515">&#34;operation not supported!&#34;</span>  
        exit 1  
<span style="color:#00f">fi</span>  </pre></div>
<p><strong>2.windows</strong></p>

<p>由于对bat不熟，所以没有写成上面那种比较详细的脚本。但其实上面真正有用的只有三句：两个curl语句和一个wget语句。而curl和wget都有windows版本的。也很好写，最简单的例子，把下面的内容复制到一个文本里，将其改名为emlog_backup.bat，也可以工作：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">curl -d &#34;user=xxxx&amp;pw=123456&#34;  http://www.pureage.info/admin/index.php?action=login -c cookie  
  
curl  -b cookie -L -d &#34;table_box[0]=emlog_attachment&amp;table_box[1]=emlog_blog&amp;table_box[2]=emlog_comment&amp;table_box[3]=emlog_options&amp;table_box[4]=emlog_navi&amp;table_box[5]=emlog_reply&amp;table_box[6]=emlog_sort&amp;table_box[7]=emlog_link&amp;table_box[8]=emlog_tag&amp;table_box[9]=emlog_trackback&amp;table_box[10]=emlog_twitter&amp;table_box[11]=emlog_user&#34;  www.pureage.info/admin/data.php?action=bakstart&gt;myemlog.sql  
  
wget  -r  -nH --cut-dirs=3 -nv  ftp://admin:123456@127.0.0.1/domains/pureage.info/public_html/content  </pre></div>
		</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = '';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div><a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


</body>
</html>
