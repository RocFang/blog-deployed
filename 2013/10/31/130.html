<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>关于proxy_pass的参数路径问题 - 纯真年代</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="关于proxy_pass的参数路径问题" />
<meta property="og:description" content="由于工作需要，开始分析nginx的proxy模块，在分析之前，当然要先会用了。于是开始熟悉该模块的一些指令，其中最基本的指令要属proxy_pass了。nginx的英文文档总是看着感觉有些别扭，于是按惯例先google了一些文章。

这一搜，就掉进坑里了。

这些文章里都把proxy_pass的目标地址是形如“127.0.0.1:8090”和“127.0.0.1:8090/”分开讨论，认为后者“/&ldquo;的作用是删除url中匹配的部分，然后再讨论目标地址中带了uri的情况。

其实根本没这么复杂，只有两种情况：

（1）目标地址中不带uri。即proxy_pass的参数形如&rdquo;http://127.0.0.1:8090&quot;。
此时新的目标url中，匹配的uri部分不做修改，原来是什么样就是什么样。

（2）目标地址中带uri。即proxy_pass的参数形如“http://127.0.0.1:8090/dir1/dir2&quot;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pureage.info/2013/10/31/130.html" />
<meta property="article:published_time" content="2013-10-31T04:16:00&#43;00:00"/>
<meta property="article:modified_time" content="2013-10-31T04:16:00&#43;00:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="关于proxy_pass的参数路径问题"/>
<meta name="twitter:description" content="由于工作需要，开始分析nginx的proxy模块，在分析之前，当然要先会用了。于是开始熟悉该模块的一些指令，其中最基本的指令要属proxy_pass了。nginx的英文文档总是看着感觉有些别扭，于是按惯例先google了一些文章。

这一搜，就掉进坑里了。

这些文章里都把proxy_pass的目标地址是形如“127.0.0.1:8090”和“127.0.0.1:8090/”分开讨论，认为后者“/&ldquo;的作用是删除url中匹配的部分，然后再讨论目标地址中带了uri的情况。

其实根本没这么复杂，只有两种情况：

（1）目标地址中不带uri。即proxy_pass的参数形如&rdquo;http://127.0.0.1:8090&quot;。
此时新的目标url中，匹配的uri部分不做修改，原来是什么样就是什么样。

（2）目标地址中带uri。即proxy_pass的参数形如“http://127.0.0.1:8090/dir1/dir2&quot;"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" /><script src="/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title">纯真年代</h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">首页</a>
			</li>
			
			<li>
				<a href="/post">归档</a>
			</li>
			
			<li>
				<a href="/about">关于</a>
			</li>
			
			<li>
				<a href="/tags">标签</a>
			</li>
			
			<li>
				<a href="/tools">工具</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">关于proxy_pass的参数路径问题</h1>
			<div class="meta">Posted at &mdash; Oct 31, 2013</div>
		</div>

		<div class="markdown">
			<p>由于工作需要，开始分析nginx的proxy模块，在分析之前，当然要先会用了。于是开始熟悉该模块的一些指令，其中最基本的指令要属proxy_pass了。nginx的英文文档总是看着感觉有些别扭，于是按惯例先google了一些文章。</p>

<p>这一搜，就掉进坑里了。</p>

<p>这些文章里都把proxy_pass的目标地址是形如“127.0.0.1:8090”和“127.0.0.1:8090/”分开讨论，认为后者“/&ldquo;的作用是删除url中匹配的部分，然后再讨论目标地址中带了uri的情况。</p>

<p>其实根本没这么复杂，只有两种情况：</p>

<p>（1）目标地址中不带uri。即proxy_pass的参数形如&rdquo;<a href="http://127.0.0.1:8090&quot;。">http://127.0.0.1:8090&quot;。</a>
此时新的目标url中，匹配的uri部分不做修改，原来是什么样就是什么样。</p>

<p>（2）目标地址中带uri。即proxy_pass的参数形如“<a href="http://127.0.0.1:8090/dir1/dir2&quot;">http://127.0.0.1:8090/dir1/dir2&quot;</a></p>

<p>此时新的目标url中，匹配的uri部分将会被修改为该参数中的uri，如&rdquo;<a href="http://127.0.0.1:8888/dir1/dir2.&quot;">http://127.0.0.1:8888/dir1/dir2.&quot;</a></p>

<p>有人说，你没有讨论ip和端口后带不带”/“的区别。其实是不需要的，因为&rdquo;/&ldquo;本身就是一种uri，很明显属于上面的第二种情况，只不过是把原来的uri修改为了现在的uri（”/&rdquo;)，看上去，像是删除了原url中匹配的部分。如果不理解这一点，就会总想着去牢记、区分结尾带不带&rdquo;/&ldquo;的情况。<br />
官方文档也是这么叙述的，根本没有提及半句“/&ldquo;：</p>

<blockquote>
<p>A request URI is passed to the server as follows:</p>

<p>If the proxy_pass directive is specified with a URI, then when a request is passed to the server, the part of a normalized request URI matching the location is replaced by a URI specified in the directive:<br />
location /name/ {<br />
    proxy_pass <a href="http://127.0.0.1/remote/">http://127.0.0.1/remote/</a>;<br />
}<br />
If proxy_pass is specified without a URI, the request URI is passed to the server in the same form as sent by a client when the original request is processed, or the full normalized request URI is passed when processing the changed URI:<br />
location /some/path/ {<br />
    proxy_pass <a href="http://127.0.0.1">http://127.0.0.1</a>;<br />
}</p>
</blockquote>

<p>测试部分如下。</p>

<p>如果配置为：</p>

<blockquote>
<p>server {<br />
                listen 9090;<br />
                access_log /home/strider/project/nginx/nginx-1.4.2/log/access_9090.log;<br />
                location /test1/test2/{<br />
                proxy_pass <a href="http://127.0.0.1:8090">http://127.0.0.1:8090</a>;<br />
                }<br />
            }</p>
</blockquote>

<p>则有如下对应关系：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">127.0.0.1:9090/test1/test2/echo1-----&gt;127.0.0.1:8090/test1/test2/echo1  
127.0.0.1:9090/test1/test2/----&gt;127.0.0.1:8090/test1/test2  </pre></div>
<p>如果配置为：</p>

<blockquote>
<p>server {<br />
                listen 9090;<br />
                access_log /home/strider/project/nginx/nginx-1.4.2/log/access_9090.log;<br />
                location /test1/test2/{<br />
                proxy_pass <a href="http://127.0.0.1:8090/">http://127.0.0.1:8090/</a>;<br />
                }<br />
            }</p>
</blockquote>

<p>则有如下对应关系：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">127.0.0.1:9090/test1/test2/echo1-----&gt;127.0.0.1:8090/echo1  
127.0.0.1:9090/test1/test2/----&gt;127.0.0.1:8090/  </pre></div>
<p>如果配置为：<br />
&gt;server {<br />
                listen 9090;<br />
                access_log /home/strider/project/nginx/nginx-1.4.2/log/access_9090.log;<br />
                location /test1/test2/{<br />
                        proxy_pass <a href="http://127.0.0.1:8090/test1">http://127.0.0.1:8090/test1</a>;<br />
                        }<br />
            }</p>

<p>则有如下对应关系：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">127.0.0.1:9090/test1/test2/echo1-----&gt;127.0.0.1:8090/test1echo1  
127.0.0.1:9090/test1/test2/----&gt;127.0.0.1:8090/test1  </pre></div>
<p>如果配置为：</p>

<blockquote>
<p>server {<br />
                listen 9090;<br />
                access_log /home/strider/project/nginx/nginx-1.4.2/log/access_9090.log;<br />
                location /test1/test2/{<br />
                        proxy_pass <a href="http://127.0.0.1:8090/test3/test4/test5">http://127.0.0.1:8090/test3/test4/test5</a>;<br />
                        }<br />
            }</p>
</blockquote>

<p>则有如下对应关系：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">127.0.0.1:9090/test1/test2/echo1-----&gt;127.0.0.1:8090/test3/test4/test5echo1  
127.0.0.1:9090/test1/test2/----&gt;127.0.0.1:80990/test3/test4/test5  </pre></div>
		</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = '';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div><a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


</body>
</html>
