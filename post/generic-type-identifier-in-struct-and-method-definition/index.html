<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="strider (方鹏)">
<meta name="description" content="一个伪文青兼程序员的自嗨
    ">
<meta name="keywords" content="博客, 技术, 文学, 电影">
<meta name="referrer" content="always">
<title>Rust 中 struct 与其 method 定义中的范型标识符 - 纯真年代</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://pureage.info/">纯真年代</a></h1><h2><a href="https://pureage.info/">阅读、体验、沉淀...</a></h2>
  </div>
  <nav><a href="/">博客</a><a href="/tools/">工具</a><a href="/about/">关于</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>Rust 中 struct 与其 method 定义中的范型标识符</h1>
  </div>
<div class="meta">
  <div>2019-08-24</div>
  <div>
    <span><a href="/tags/rust">#rust</a></span>
    </div>
  </div>
<div class="content">
  <p>Rust 中，在 struct 定义中使用范型的方法，是在 struct 名称后跟&lt;范型标识符&gt;，例如：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#00f">struct</span> <span style="color:#000">Int</span>&lt;<span style="color:#000">T</span>&gt; 
</code></pre></div><p>而在 struct 的方法的定义中使用范型，则是形如：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#00f">impl</span>&lt;<span style="color:#000">T</span>&gt; <span style="color:#000">Int</span>&lt;<span style="color:#000">T</span>&gt; 
</code></pre></div><p>注意这里有两个范型标识符<code>&lt;T&gt;</code>。</p>
<p>impl 后面的<code>&lt;T&gt;</code>并不是可有可无的，如果其后有<code>&lt;T&gt;</code>，则后面 struct 名字后面的<code>&lt;T&gt;</code>才会被编译器认为是范型，否则编译器它是一个具体类型。</p>
<p>Rust 使用这种方式可以来实现对一个范型的不同具体类型定义不同的方法的功能。</p>
<p>如下面的代码所示，x 方法为所有 Int 实例所共有，但 x32 方法和 x64 方法则分别仅为具体类型为 i32 和 i64 的 Int 实例所有：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#00f">struct</span> <span style="color:#000">Int</span>&lt;<span style="color:#000">T</span>&gt; {
    <span style="color:#000">x</span>: <span style="color:#000">T</span>,
}
<span style="color:#00f">impl</span>&lt;<span style="color:#000">T</span>&gt; <span style="color:#000">Int</span>&lt;<span style="color:#000">T</span>&gt; {
    <span style="color:#00f">fn</span> <span style="color:#000">x</span>(&amp;<span style="color:#000">self</span>) -&gt; <span style="color:#00f">&amp;</span><span style="color:#000">T</span> {
        &amp;<span style="color:#000">self</span>.<span style="color:#000">x</span>
    }
}
<span style="color:#00f">impl</span> <span style="color:#000">Int</span>&lt;<span style="color:#00f">i32</span>&gt; {
    <span style="color:#00f">fn</span> <span style="color:#000">x32</span>(&amp;<span style="color:#000">self</span>) -&gt; <span style="color:#00f">&amp;</span><span style="color:#00f">i32</span> {
        &amp;<span style="color:#000">self</span>.<span style="color:#000">x</span>
    }
}
<span style="color:#00f">impl</span> <span style="color:#000">Int</span>&lt;<span style="color:#00f">i64</span>&gt; {
    <span style="color:#00f">fn</span> <span style="color:#000">x64</span>(&amp;<span style="color:#000">self</span>) -&gt; <span style="color:#00f">&amp;</span><span style="color:#00f">i64</span> {
        &amp;<span style="color:#000">self</span>.<span style="color:#000">x</span>
    }
}
<span style="color:#00f">fn</span> <span style="color:#000">main</span>() {
    <span style="color:#00f">let</span> <span style="color:#000">p</span> = <span style="color:#000">Int</span> { <span style="color:#000">x</span>: <span style="color:#3af">5</span>};
    <span style="color:#000">println</span>!(<span style="color:#5a2">&#34;p.x = {}&#34;</span>, <span style="color:#000">p</span>.<span style="color:#000">x</span>());
    <span style="color:#000">println</span>!(<span style="color:#5a2">&#34;p.x32 = {}&#34;</span>, <span style="color:#000">p</span>.<span style="color:#000">x32</span>());
    <span style="color:#888;font-style:italic">//下面的注释掉的是错误语句
</span><span style="color:#888;font-style:italic"></span>    <span style="color:#888;font-style:italic">//println!(&#34;p.x64={}&#34;, p.x64());
</span><span style="color:#888;font-style:italic"></span>    <span style="color:#00f">let</span> <span style="color:#000">p2</span> = <span style="color:#000">Int</span> {<span style="color:#000">x</span>: <span style="color:#3af">5</span><span style="color:#00f">i64</span>};
    <span style="color:#000">println</span>!(<span style="color:#5a2">&#34;p2.x = {}&#34;</span>, <span style="color:#000">p2</span>.<span style="color:#000">x</span>());
    <span style="color:#888;font-style:italic">//下面的注释掉的是错误语句
</span><span style="color:#888;font-style:italic"></span>    <span style="color:#888;font-style:italic">//println!(&#34;p2.x32 = {}&#34;, p2.x32());
</span><span style="color:#888;font-style:italic"></span>    <span style="color:#000">println</span>!(<span style="color:#5a2">&#34;p2.x64 = {}&#34;</span>, <span style="color:#000">p2</span>.<span style="color:#000">x64</span>());
}
</code></pre></div></div>

  </article>
</main>
<footer>
  <div>
    <div>2011-2020 strider. <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC-BY-4.0</a></div>
  </div>
</footer>
</body>
</html>
