<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="strider (方鹏)">
<meta name="description" content="一个伪文青兼程序员的自嗨
    ">
<meta name="keywords" content="博客, 技术, 文学, 电影">
<meta name="referrer" content="always">
<title>在阅读《Rust 编程之道》时的一次抬杠经历 - 纯真年代</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
<link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
<header>
  <div>
    <h1><a href="https://pureage.info/">纯真年代</a></h1><h2><a href="https://pureage.info/">阅读、体验、沉淀...</a></h2>
  </div>
  <nav><a href="/">博客</a><a href="/tools/">工具</a><a href="/about/">关于</a></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>在阅读《Rust 编程之道》时的一次抬杠经历</h1>
  </div>
<div class="meta">
  <div>2019-08-16</div>
  <div>
    <span><a href="/tags/rust">#Rust</a></span>
    <span><a href="/tags/%E8%AF%BB%E4%B9%A6">#读书</a></span>
    </div>
  </div>
<div class="content">
  <p>最近学习Rust,在看完了官网上的 Rust Book 之后，我买了一本张汉东老师著的《Rust 编程之道》，来两本书对照着再看一遍。</p>
<p>今天要说的，就是发生在阅读《Rust 编程之道》时发生的一个我认为很有意思的小事。</p>
<p>本文标题中提到“抬杠”，实际上我并不是就书的某些内容跟作者或其他读者抬杠，而是与自己抬杠。</p>
<p>起因是我读到的该书中的一段话，原文如下：</p>
<blockquote>
<p>条件表达式一定会有值，所以 if 表达式的分支必须返回同一个类型的值才可以。这也是 Rust 没有三元操作符 ?: 的原因。</p>
</blockquote>
<p>由于我之前已经完整的读过了一本 Rust 教材，而且也有其他语言的编程基础，所以这句话里传达的知识点本身我都已经是明白的。但读完后第一感觉就是不顺。不知道其他人看到这一段话第一反应会怎么理解，我的心理过程是这样的：</p>
<p>第一句，“条件表达式一定会有值，所以 if 表达式的分支必须返回同一个类型的值才可以”，没问题，这一句很简单，跳过。</p>
<p>第二句，“这也是 Rust 没有三元操作符 ?: 的原因”，看上去有点意思，关于来龙去脉的东西要好好看一下，回顾一下上一句，上一句是”所以 if 表达式的分支必须返回同一个类型的值才可以”。有一个<strong>必须</strong>哦，所以说 Rust 没有三元操作符是因为三元操作符不满足这个<strong>必须</strong>的要求？也就说，因为 if 表达式必须返回同一个类型的值，但三元操作符不满足这个要求，所以 Rust 中没有三元操作符？</p>
<p>我心里马上咯噔一下，三元操作符还有这毛病？印象中不是这样啊。于是随手写了几行 c 代码用 gcc 验证了一下，更坚定我的信心了，至少在 c 里面，三元操作符是没有这个问题的。于是我在微信里向张汉东老师本人求证：</p>
<blockquote>
<p>汉东老师，在 2.5.1 条件表达式这一节，书里说 “表达式一定会有值，所以 if 表达式的分支必须返回同一个类型的值才可以。这也是 Rust 没有三元操作符 ?: 的原因。”</p>
<p>读起来感觉这一句话有点问题，感觉您想表达因为三元操作符可能会返回不同类型的值，所以才没有支持三元操作符。</p>
<p>一方面，在 c 里面，虽然 int a = 1 == 2 ? 2 : “aa”; 这样的语句编译器不会报错,但是会报类型不匹配和一个从指针到整数的类型转换的警告，而且这个其实跟三目运算本身没关系，直接用 int a = “aa”,也是会涉及到相同的警告，即类型不匹配和一个从指针到整数的类型转换。</p>
<p>另一方面，我查了一下 rust 以前的 issues，比如 <a href="https://github.com/rust-lang/rfcs/issues/1362">https://github.com/rust-lang/rfcs/issues/1362</a> （不止这一个），里面的讨论也大部分都是基于有没有必要在 if else 满足条件的情况下引入一个三目操作，而且 rust 之前的版本里本来是有三目，后来有觉得没必要所以去掉了。</p>
<p>总之我想表达的是可能 rust 没有三元操作符不是因为这个原因，不知道我理解有没有问题。谢谢：）</p>
</blockquote>
<p>张汉东老师很快就回复我了：</p>
<blockquote>
<p>你想太多了。我想表达的就是两点：</p>
<ol>
<li>if 是个表达式。表达式自然要返回同一个类型的值。</li>
<li>有了这个表达式就没必要引入三元操作符了（所以，没有三元操作符），你看看 Rust 的语法，基本上是避免同一件事引入多种方法。再加上三元操作符中的两个符号「:」和「?」，在 Rust 里会破坏一致性。</li>
</ol>
</blockquote>
<p>这个回复非常清楚，没有任何问题和歧义。本身这几个知识点我是理解的，所以我非常好奇，是什么原因导致我把他的原句理解成了我上面所说的样子，这个原因必须找出来。</p>
<p>再次回顾一下原文：</p>
<blockquote>
<p>条件表达式一定会有值，所以if表达式的分支必须返回同一个类型的值才可以。这也是 Rust 没有三元操作符 ?: 的原因。</p>
</blockquote>
<p>顿时恍然大悟。</p>
<p>这两句话的最重要的地方是第一句话的前半部分，即“条件表达式一定会有值”，基于此，会产生两个结果，其一是 if 表达式的分支必须返回同一个类型的值，其二是 Rust 中不必有三元操作符。这两个结果的关系是<strong>并列</strong>的。</p>
<p>而我之前对这段话的理解错误，根源在于把第二句话中提到的原因归结到了第一句话的后半句，实际应该是前半句。而为什么我会第一反应做出如此的理解呢？原因在于第一句后半句中的那个<strong>必须</strong>一词，它的语气很强，把我的注意力吸引到它上面，而失去了对这一段话整体结构的把握。</p>
<p>上面就是我跟自己”抬杠“的完整过程。这个过程不由让我想到《如何阅读一本书》中的一个比喻，在一场阅读的过程中，作者与读者就像是棒球赛场中的一对投手和捕手。写作与阅读的东西就像那只球一样，是被主动、有活力的双方所共有的，由一方开始，另一方终结。</p>
<p>读一本书，能完全读懂作者在写作时的心理状态和想表达的内容，真不是一件容易的事情。逻辑性很强的一本编程书都是如此，其他领域，尤其文学作品中就更难了。我想也正因为如此，才导致了一千个读者就有一千个哈姆雷特吧。</p></div>

  </article>
</main>
<footer>
  <div>
    <div>2011-2020 strider. <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC-BY-4.0</a><p>Powered by <a href="https://gohugo.io/">Hugo</a> with <a href="https://github.com/yanlinlin82/simple-style">Simple-Style</a></div>
  </div>
</footer>
</body>
</html>
